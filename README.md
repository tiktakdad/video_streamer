# Video Streamer 테스트 가이드

이 프로젝트는 `sample.mp4`와 `voice_sample.wav`를 네트워크 스트림으로 보내고, VLC에서 수신해 재생하는 테스트입니다.

## VLC 설정 방법 (자세한 단계)

1. **VLC 실행**
2. 상단 메뉴에서 **파일**을 클릭합니다.
3. **네트워크 열기**를 선택합니다.
4. **RTP/UDP 스트림 열기** 탭으로 이동합니다.
5. **UDP**를 선택합니다.
6. 전송 방식은 **유니캐스트**로 설정합니다.
7. **포트**에 `5004`를 입력합니다.
8. **열기** 버튼을 눌러 수신 대기 상태로 둡니다.

> 참고: 아래 스크린샷을 확인하세요.

![VLC 네트워크 스트림 설정](vlc_p.png)

## 스트림 전송 테스트 실행

VLC가 수신 대기 상태일 때 아래 명령을 실행합니다.

```bash
python test_sample_video.py
```

실행되면 `sample.mp4`의 영상과 `voice_sample.wav`의 오디오가 함께 전송됩니다.

## 문제 해결 팁

- 영상/음성이 안 나오면 **VLC가 먼저 열려 있는지** 확인하세요.
- 포트가 다르면 VLC와 전송 코드의 포트를 동일하게 맞춰야 합니다.
- 방화벽이 UDP를 막고 있으면 로컬호스트에서도 재생이 안 될 수 있습니다.

## 동작 방식 요약 (자세히)

1. `test_sample_video.py`가 테스트에 필요한 경로를 만든 뒤 `play_video_vlc.py`를 실행합니다.
2. `play_video_vlc.py`가 `sample.mp4`를 OpenCV로 열고, 해상도와 FPS를 읽습니다.
3. `voice_sample.wav`는 `wave` 모듈로 열어 **샘플레이트/채널 수/16-bit PCM** 여부를 확인합니다.
4. 전송 대상은 `udp://{host}:{port}` 형식의 **MPEG-TS 스트림**이며, 기본 포트는 `5004`입니다.
5. 영상은 `--video-chunk-frames` 단위로 프레임을 묶어 **영상 큐에 적재**합니다.
6. 음성은 `--audio-chunk-frames` 단위로 샘플을 묶어 **음성 큐에 적재**합니다.
7. 메인 루프는 **PTS(타임스탬프)** 기준으로 영상/음성 큐에서 데이터를 꺼내 순서를 맞춥니다.
8. 영상은 `bgr24` 포맷으로 `VideoFrame`을 만들고, `libx264`로 인코딩합니다.
9. 음성은 `s16` 포맷으로 `AudioFrame`을 만들고, `aac`로 인코딩합니다.
10. 인코딩된 패킷을 `mpegts` 컨테이너에 **mux**한 뒤 UDP로 송출합니다.
11. VLC는 `udp://@:5004`에서 스트림을 받아 영상과 오디오를 재생합니다.

> 참고: 버퍼 크기나 청크 크기를 키우면 안정성은 올라가지만 지연이 늘어날 수 있습니다.
